# Stress Test: Map Marker Taps
# Tests tapping on activity markers rendered via MarkerView
# Verifies that markers are accessible and tappable via testID
# Demo activity IDs use format: demo-YYYY-MM-DD-N (e.g., demo-2026-01-14-0)
# Reference date: 2026-01-15 (some dates may be rest days)

appId: com.veloq.app
---
- launchApp

- extendedWaitUntil:
    visible:
      id: "login-screen"
    timeout: 30000

- tapOn:
    id: "login-demo-button"

- extendedWaitUntil:
    visible:
      id: "home-screen"
    timeout: 15000

# Navigate to map screen
- openLink: "veloq://map"

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 15000

# Wait for map to load and markers to render
- extendedWaitUntil:
    visible:
      id: "map-toggle-activities"
    timeout: 10000
    optional: true

# Try to tap on demo activity markers (format: demo-YYYY-MM-DD-N)
# Reference date is 2026-01-15, use nearby dates that are likely to have activities
# These use MarkerView which renders React Native Views with testIDs
- tapOn:
    id: "map-activity-marker-demo-2026-01-14-0"
    optional: true

# If marker was tapped, activity popup should appear
- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 3000
    optional: true

# Try view details if popup appeared
- tapOn:
    id: "activity-popup-view-details"
    optional: true

# Go back to map
- openLink: "veloq://map"

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 10000

# Try tapping multiple markers rapidly (using dates near reference)
- repeat:
    times: 3
    commands:
      - tapOn:
          id: "map-activity-marker-demo-2026-01-14-0"
          optional: true
      - tapOn:
          id: "map-activity-marker-demo-2026-01-13-0"
          optional: true
      - tapOn:
          id: "map-activity-marker-demo-2026-01-12-0"
          optional: true

# Verify map is still responsive
- assertVisible:
    id: "map-screen"

- takeScreenshot: "stress-map-marker-taps-complete"
