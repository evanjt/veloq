# Comprehensive Map Integration Test
# Tests map features: activities, routes, sections, popups, filters, and toggles

appId: com.veloq.app
tags:
  - tier2
---
- runFlow:
    file: helpers/setup-demo-mode.yaml

- runFlow:
    file: helpers/navigate-to-map.yaml

# Wait for map controls to load
- extendedWaitUntil:
    visible:
      id: "map-toggle-activities"
    timeout: 10000

# =============================================================================
# Activity Markers - Basic Interaction
# =============================================================================

- tapOn:
    id: "map-fit-all"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-activity-marker-demo-test-0"
    optional: true

- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 3000
    optional: true

- tapOn:
    id: "activity-popup-zoom"
    optional: true

- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 2000
    optional: true

- tapOn:
    id: "activity-popup-close"
    optional: true

- extendedWaitUntil:
    notVisible:
      id: "activity-popup"
    timeout: 2000
    optional: true

# =============================================================================
# Activity Details Navigation
# =============================================================================

- openLink: "veloq://map"

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 5000

- extendedWaitUntil:
    visible:
      id: "map-toggle-activities"
    timeout: 3000

- tapOn:
    id: "map-activity-marker-demo-test-0"
    optional: true

- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 3000
    optional: true

- tapOn:
    id: "activity-popup-view-details"
    optional: true

- extendedWaitUntil:
    visible:
      id: "activity-detail-screen"
    timeout: 10000
    optional: true

- openLink: "veloq://map"

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 10000

# =============================================================================
# Multi-Marker Test
# =============================================================================

- tapOn:
    id: "map-fit-all"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-activity-marker-demo-test-0"
    optional: true
- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 2000
    optional: true
- tapOn:
    id: "activity-popup-close"
    optional: true

- tapOn:
    id: "map-activity-marker-demo-test-1"
    optional: true
- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 2000
    optional: true
- tapOn:
    id: "activity-popup-close"
    optional: true

- tapOn:
    id: "map-activity-marker-demo-test-2"
    optional: true
- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 2000
    optional: true
- tapOn:
    id: "activity-popup-close"
    optional: true

- tapOn:
    id: "map-activity-marker-demo-test-3"
    optional: true
- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 2000
    optional: true
- tapOn:
    id: "activity-popup-close"
    optional: true

- tapOn:
    id: "map-activity-marker-demo-test-4"
    optional: true
- extendedWaitUntil:
    visible:
      id: "activity-popup"
    timeout: 2000
    optional: true
- tapOn:
    id: "activity-popup-close"
    optional: true

# =============================================================================
# Sport Type Filters
# =============================================================================

- tapOn:
    id: "map-filter-ride"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-filter-run"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-filter-swim"
    optional: true

- tapOn:
    id: "map-filter-hike"
    optional: true

- tapOn:
    id: "map-filter-clear"
    optional: true

# =============================================================================
# Layer Toggles
# =============================================================================

- tapOn:
    id: "map-toggle-activities"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-toggle-sections"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-toggle-routes"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

# Toggle back on
- tapOn:
    id: "map-toggle-routes"
    optional: true

- tapOn:
    id: "map-toggle-sections"
    optional: true

- tapOn:
    id: "map-toggle-activities"
    optional: true

- tapOn:
    id: "map-toggle-heatmap"
    optional: true

# =============================================================================
# Toggle Stress Test
# =============================================================================

- repeat:
    times: 4
    commands:
      - tapOn:
          id: "map-toggle-activities"
          optional: true
      - tapOn:
          id: "map-toggle-routes"
          optional: true
      - tapOn:
          id: "map-toggle-sections"
          optional: true

# =============================================================================
# 3D Mode and Map Controls
# =============================================================================

- tapOn:
    id: "map-toggle-3d"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-compass"
    optional: true

- tapOn:
    id: "map-location"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-fit-all"
    optional: true

- extendedWaitUntil:
    visible:
      id: "map-screen"
    timeout: 2000

- tapOn:
    id: "map-toggle-3d"
    optional: true

# =============================================================================
# Final State Validation
# =============================================================================

- assertVisible:
    id: "map-screen"

- takeScreenshot: "map-comprehensive-complete"
